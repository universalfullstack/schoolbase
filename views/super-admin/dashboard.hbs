<div class="dashboard-page">

  <!-- Greeting -->
  <div class="section">
    <h4>Super Admin Dashboard</h4>
  </div>

  <!-- Stats Cards -->
  <div class="row">
    <div class="col s12 m6 l3">
      <div class="card">
        <div class="card-content">
          <span class="card-title">Schools</span>
          <h5>{{stats.totalSchools}}</h5>
        </div>
      </div>
    </div>
    <div class="col s12 m6 l3">
      <div class="card">
        <div class="card-content">
          <span class="card-title">Students</span>
          <h5>{{stats.totalStudents}}</h5>
        </div>
      </div>
    </div>
    <div class="col s12 m6 l3">
      <div class="card">
        <div class="card-content">
          <span class="card-title">Staff</span>
          <h5>{{stats.totalStaff}}</h5>
        </div>
      </div>
    </div>
    <div class="col s12 m6 l3">
      <div class="card">
        <div class="card-content">
          <span class="card-title">School Admins</span>
          <h5>{{stats.totalSchoolAdmins}}</h5>
        </div>
      </div>
    </div>
  </div>

  <!-- Charts -->
  <div class="row">
    <!-- Subscription Trend Chart -->
    <div class="col s12 m6">
      <div class="card">
        <div class="card-content">
          <span class="card-title">Subscriptions Trend (Last 6 Months)</span>
          <canvas id="trendChart"></canvas>
        </div>
      </div>
    </div>

    <!-- Subscription Status Chart -->
    <div class="col s12 m6">
      <div class="card">
        <div class="card-content">
          <span class="card-title">Subscriptions by Status</span>
          <canvas id="statusChart"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Latest Subscriptions Table -->
  <div class="row">
    <div class="col s12">
      <div class="card">
        <div class="card-content">
          <span class="card-title">Latest Subscriptions</span>
          <table class="striped">
            <thead>
              <tr>
                <th>School</th>
                <th>Plan</th>
                <th>Start Date</th>
                <th>End Date</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              {{#each latestSubscriptions}}
                <tr>
                  <td>{{school}}</td>
                  <td>{{plan}}</td>
                  <td>{{startDate}}</td>
                  <td>{{endDate}}</td>
                  <td>{{status}}</td>
                </tr>
              {{/each}}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

</div>

<script>
  // Ensure data is passed safely using lowercase json helper
  const trendLabels = {{{json trendLabels}}};
  const trendData = {{{json trendData}}};
  const statusLabels = {{{json statusLabels}}};
  const statusData = {{{json statusData}}};

  // Subscription Trend Chart
  new Chart(document.getElementById('trendChart'), {
    type: 'line',
    data: {
      labels: trendLabels,
      datasets: [{
        label: 'Subscriptions',
        data: trendData,
        borderColor: 'rgba(63,81,181,1)',
        backgroundColor: 'rgba(63,81,181,0.2)',
        fill: true,
        tension: 0.3
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display: true },
        tooltip: { enabled: true }
      },
      scales: {
        y: { beginAtZero: true }
      }
    }
  });

  // Subscription Status Chart
  new Chart(document.getElementById('statusChart'), {
    type: 'doughnut',
    data: {
      labels: statusLabels,
      datasets: [{
        label: 'Subscriptions',
        data: statusData,
        backgroundColor: [
          'rgba(76,175,80,0.7)', // active - green
          'rgba(244,67,54,0.7)', // expired - red
          'rgba(255,193,7,0.7)', // pending - yellow
          'rgba(158,158,158,0.7)' // cancelled - gray
        ],
        borderColor: 'rgba(255,255,255,0.8)',
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { position: 'bottom' },
        tooltip: { enabled: true }
      }
    }
  });
</script>
