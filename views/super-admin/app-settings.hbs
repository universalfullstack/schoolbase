<div class="container py-4">

  <!-- Header -->
  <div class="d-flex align-items-center mb-4">
    <i class="bi bi-gear fs-4 me-2"></i>
    <h4 class="mb-0">App Settings</h4>
  </div>

  {{> flashMessages}}

  <form method="POST" enctype="multipart/form-data">

    <!-- ================= TABS ================= -->
   <ul class="nav nav-tabs mb-3" role="tablist">
  <li class="nav-item" role="presentation">
    <button
      type="button"
      class="nav-link active"
      data-bs-toggle="tab"
      data-bs-target="#general"
      role="tab">
      General
    </button>
  </li>

  <li class="nav-item" role="presentation">
    <button
      type="button"
      class="nav-link"
      data-bs-toggle="tab"
      data-bs-target="#branding"
      role="tab">
      Branding
    </button>
  </li>

  <li class="nav-item" role="presentation">
    <button
      type="button"
      class="nav-link"
      data-bs-toggle="tab"
      data-bs-target="#messaging"
      role="tab">
      Messaging
    </button>
  </li>
</ul>

    <div class="tab-content">

      <!-- ================= GENERAL ================= -->
      <div class="tab-pane fade show active" id="general">

        <!-- System Info -->
        <div class="card shadow-sm mb-4">
          <div class="card-body">
            <h6 class="mb-3">
              <i class="bi bi-info-circle me-1"></i> System Info
            </h6>

            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">System Name</label>
                <input type="text" name="systemName" class="form-control"
                       value="{{settings.general.systemName}}">
              </div>

              <div class="col-md-6">
                <label class="form-label">Abbreviation</label>
                <input type="text" name="abbreviation" class="form-control"
                       value="{{settings.general.abbreviation}}">
              </div>
            </div>

            <div class="mt-3">
              <label class="form-label">Description</label>
              <textarea name="description" class="form-control" rows="3">
{{settings.general.description}}</textarea>
            </div>

            <div class="row g-3 mt-2">
              <div class="col-md-6">
                <label class="form-label">Currency</label>
                <input type="text" name="currency" class="form-control"
                       value="{{settings.general.currency}}">
              </div>

              <div class="col-md-6">
                <label class="form-label">Timezone</label>
                <input type="text" name="timezone" class="form-control"
                       value="{{settings.general.timezone}}">
              </div>
            </div>
          </div>
        </div>

        <!-- Contact Info -->
        <div class="card shadow-sm">
          <div class="card-body">
            <h6 class="mb-3">
              <i class="bi bi-envelope me-1"></i> Contact Info
            </h6>

            <div class="mb-3">
              <label class="form-label">Support Email</label>
              <input type="email" name="contactEmail" class="form-control"
                     value="{{settings.contact.email}}">
            </div>

            <div class="mb-3">
              <label class="form-label">Support Phone</label>
              <input type="text" name="contactPhone" class="form-control"
                     value="{{settings.contact.phone}}">
            </div>

            <div>
              <label class="form-label">Office Address</label>
              <textarea name="contactAddress" class="form-control" rows="2">
{{settings.contact.address}}</textarea>
            </div>
          </div>
        </div>
      </div>

      <!-- ================= BRANDING ================= -->
      <div class="tab-pane fade" id="branding">

        <div class="card shadow-sm">
          <div class="card-body">
            <h6 class="mb-3">
              <i class="bi bi-palette me-1"></i> Branding
            </h6>

            <div class="row g-4 text-center">

              <!-- Logo -->
              <div class="col-md-6">
                <label class="form-label d-block">Logo</label>
                <div class="image-dropzone mx-auto" id="logoDropzone" style="width:150px;height:150px;">
                  <img id="logoPreview"
                       src="{{settings.branding.logo}}"
                       class="img-fluid">
                  <div class="overlay">
                    <i class="bi bi-camera fs-3"></i>
                  </div>
                </div>
                <input type="file" id="logoInput" name="logo" class="d-none" accept="image/*">
                <small class="text-muted">150×150px recommended</small>
              </div>

              <!-- Favicon -->
              <div class="col-md-6">
                <label class="form-label d-block">Favicon</label>
                <div class="image-dropzone mx-auto" id="faviconDropzone" style="width:80px;height:80px;">
                  <img id="faviconPreview"
                       src="{{settings.branding.favicon}}"
                       class="img-fluid">
                  <div class="overlay">
                    <i class="bi bi-camera fs-4"></i>
                  </div>
                </div>
                <input type="file" id="faviconInput" name="favicon" class="d-none" accept="image/*">
                <small class="text-muted">80×80px recommended</small>
              </div>
            </div>

            <div class="row g-3 mt-3">
              <div class="col-md-6">
                <label class="form-label">Primary Color</label>
                <input type="color" name="primaryColor" class="form-control form-control-color"
                       value="{{settings.branding.primaryColor}}">
              </div>
              <div class="col-md-6">
                <label class="form-label">Secondary Color</label>
                <input type="color" name="secondaryColor" class="form-control form-control-color"
                       value="{{settings.branding.secondaryColor}}">
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ================= MESSAGING ================= -->
      <div class="tab-pane fade" id="messaging">

        <div class="card shadow-sm">
          <div class="card-body">
            <h6 class="mb-3">
              <i class="bi bi-chat-dots me-1"></i> Messaging
            </h6>

            <div class="mb-3">
              <label class="form-label">Welcome Subject</label>
              <input type="text" name="welcomeSubject" class="form-control"
                     value="{{settings.messaging.general.welcome.subject}}">
            </div>

            <div class="mb-3">
              <label class="form-label">Welcome Body</label>
              <textarea name="welcomeBody" class="form-control" rows="3">
{{settings.messaging.general.welcome.body}}</textarea>
            </div>

            <div class="mb-3">
              <label class="form-label">Activation Subject</label>
              <input type="text" name="activationSubject" class="form-control"
                     value="{{settings.messaging.account.activation.subject}}">
            </div>

            <div class="mb-3">
              <label class="form-label">Activation Body</label>
              <textarea name="activationBody" class="form-control" rows="3">
{{settings.messaging.account.activation.body}}</textarea>
            </div>

            <div class="mb-3">
              <label class="form-label">Expiry Warning Subject</label>
              <input type="text" name="subscriptionExpirySubject" class="form-control"
                     value="{{settings.messaging.subscription.expiryWarning.subject}}">
            </div>

            <div>
              <label class="form-label">Expiry Warning Body</label>
              <textarea name="subscriptionExpiryBody" class="form-control" rows="3">
{{settings.messaging.subscription.expiryWarning.body}}</textarea>
            </div>
          </div>
        </div>
      </div>

    </div>

    <!-- Save -->
    <div class="mt-4">
      <button type="submit" class="btn btn-primary">
        <i class="bi bi-save me-1"></i> Save Settings
      </button>
    </div>

  </form>
</div>

{{#section "styles"}}

<style>
  .image-dropzone {
    position: relative;
    background: #f5f5f5;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .image-dropzone img {
    max-width: 100%;
    max-height: 100%;
    object-fit: cover;
  }
  .image-dropzone .overlay {
    position: absolute;
    inset: 0;
    background: rgba(0,0,0,.35);
    color: #fff;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: .2s;
  }
  .image-dropzone:hover .overlay {
    opacity: 1;
  }
</style>
{{/section}}

{{#section "scripts"}}

<script>
  function setupDropzone(zoneId, inputId, previewId) {
    const zone = document.getElementById(zoneId);
    const input = document.getElementById(inputId);
    const preview = document.getElementById(previewId);

    zone.addEventListener('click', () => input.click());

    input.addEventListener('change', () => {
      if (input.files[0]) {
        preview.src = URL.createObjectURL(input.files[0]);
      }
    });
  }

  setupDropzone('logoDropzone', 'logoInput', 'logoPreview');
  setupDropzone('faviconDropzone', 'faviconInput', 'faviconPreview');
</script>
{{/section}}

