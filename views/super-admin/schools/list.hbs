<div class="container">

  <!-- Header -->
  <div class="row valign-wrapper mb-4">
    <div class="col s12 m6">
      <h5 class="mb-0">Schools</h5>
    </div>
    <div class="col s12 m6 right-align">
      <a href="/super-admin/schools/create/new" class="btn blue waves-effect waves-light">
        Create New School
      </a>
    </div>
  </div>

  {{> flashMessages}}

  <!-- Tabs -->
  <div class="row">
    <div class="col s12">
      <ul class="tabs">
        <li class="tab col s6"><a class="active" href="#activeTab">
          Active Schools <span class="new badge green" data-badge-caption="">{{activeSchools.length}}</span>
        </a></li>
        <li class="tab col s6"><a href="#inactiveTab">
          Inactive Schools <span class="new badge grey" data-badge-caption="">{{inactiveSchools.length}}</span>
        </a></li>
      </ul>
    </div>
  </div>

  <!-- ================= ACTIVE SCHOOLS ================= -->
  <div id="activeTab" class="col s12">
    {{#if activeSchools.length}}
    <table id="activeTable" class="highlight responsive-table">
      <thead>
        <tr>
          <th>Logo</th>
          <th>School Name</th>
          <th>Subdomain</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {{#each activeSchools}}
        <tr>
          <td>
            <img src="{{#if this.logo}}{{this.logo}}{{else}}/images/school-default.png{{/if}}" 
                 alt="{{this.name}} logo" 
                 style="width:40px;height:40px;object-fit:cover;">
          </td>
          <td>{{this.name}}</td>
          <td>{{this.subdomain}}</td>
          <td>
            {{#if (eq this.status "Active")}}
              <span class="new badge green" data-badge-caption="">{{this.status}}</span>
            {{else}}
              <span class="new badge red" data-badge-caption="">{{this.status}}</span>
            {{/if}}
          </td>
          <td>
            <a href="/super-admin/schools/edit/{{this._id}}" class="btn-small blue waves-effect waves-light">Edit</a>
            <form action="/super-admin/schools/delete/{{this._id}}" method="POST" style="display:inline;" onsubmit="return confirm('Delete this school?');">
              <button class="btn-small red waves-effect waves-light" type="submit">Delete</button>
            </form>
          </td>
        </tr>
        {{/each}}
      </tbody>
    </table>
    {{else}}
      <div class="card-panel grey lighten-4">No active schools found.</div>
    {{/if}}
  </div>

  <!-- ================= INACTIVE SCHOOLS ================= -->
  <div id="inactiveTab" class="col s12">
    {{#if inactiveSchools.length}}
    <table id="inactiveTable" class="highlight responsive-table">
      <thead>
        <tr>
          <th>Logo</th>
          <th>School Name</th>
          <th>Subdomain</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {{#each inactiveSchools}}
        <tr>
          <td>
            <img src="{{#if this.logo}}{{this.logo}}{{else}}/images/school-default.png{{/if}}" 
                 alt="{{this.name}} logo" 
                 style="width:40px;height:40px;object-fit:cover;">
          </td>
          <td>{{this.name}}</td>
          <td>{{this.subdomain}}</td>
          <td>
            {{#if (eq this.status "Active")}}
              <span class="new badge green" data-badge-caption="">{{this.status}}</span>
            {{else}}
              <span class="new badge red" data-badge-caption="">{{this.status}}</span>
            {{/if}}
          </td>
          <td>
            <a href="/super-admin/schools/edit/{{this._id}}" class="btn-small blue waves-effect waves-light">Edit</a>
            <form action="/super-admin/schools/activate/{{this._id}}" method="POST" style="display:inline;" onsubmit="return confirm('Activate this school?');">
              <button class="btn-small green waves-effect waves-light" type="submit">Activate</button>
            </form>
            <form action="/super-admin/schools/delete/{{this._id}}" method="POST" style="display:inline;" onsubmit="return confirm('Delete this school?');">
              <button class="btn-small red waves-effect waves-light" type="submit">Delete</button>
            </form>
          </td>
        </tr>
        {{/each}}
      </tbody>
    </table>
    {{else}}
      <div class="card-panel grey lighten-4">No inactive schools found.</div>
    {{/if}}
  </div>

</div>

{{#section "styles"}}
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.8/css/jquery.dataTables.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.dataTables.min.css">
<style>
  table.dataTable thead th, table.dataTable tbody td {
    padding: 8px 12px;
  }
  table.dataTable tbody td img {
    border-radius: 4px;
  }
</style>
{{/section}}

{{#section "scripts"}}
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.8/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Initialize Materialize tabs
    const elems = document.querySelectorAll('.tabs');
    M.Tabs.init(elems, {});

    // Initialize DataTables
    const activeTable = $('#activeTable').DataTable({
      responsive: true,
      pageLength: 10
    });
    const inactiveTable = $('#inactiveTable').DataTable({
      responsive: true,
      pageLength: 10
    });

    // Fix column widths when switching tabs
    const tabs = document.querySelectorAll('.tabs a');
    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        activeTable.columns.adjust().responsive.recalc();
        inactiveTable.columns.adjust().responsive.recalc();
      });
    });
  });
</script>
{{/section}}
