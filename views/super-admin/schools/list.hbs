<div class="container py-4">

  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h5 class="mb-0">Schools</h5>
    <a href="/super-admin/schools/create/new" class="btn btn-primary">
      Create New School
    </a>
  </div>

  {{> flashMessages}}

  <!-- Tabs -->
  <ul class="nav nav-tabs mb-3" id="schoolTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active"
              id="active-tab"
              data-bs-toggle="tab"
              data-bs-target="#activeTab"
              type="button"
              role="tab">
        Active Schools
        <span class="badge bg-success ms-1">{{activeSchools.length}}</span>
      </button>
    </li>

    <li class="nav-item" role="presentation">
      <button class="nav-link"
              id="inactive-tab"
              data-bs-toggle="tab"
              data-bs-target="#inactiveTab"
              type="button"
              role="tab">
        Inactive Schools
        <span class="badge bg-secondary ms-1">{{inactiveSchools.length}}</span>
      </button>
    </li>
  </ul>

  <div class="tab-content">

    <!-- ================= ACTIVE SCHOOLS ================= -->
    <div class="tab-pane fade show active" id="activeTab" role="tabpanel">

      {{#if activeSchools.length}}
      <div class="table-responsive">
        <table id="activeTable" class="table table-striped table-bordered align-middle w-100">
          <thead class="table-light">
            <tr>
              <th>Logo</th>
              <th>School Name</th>
              <th>Subdomain</th>
              <th>Status</th>
              <th style="width:180px;">Actions</th>
            </tr>
          </thead>
          <tbody>
            {{#each activeSchools}}
            <tr>
              <td>
                <img src="{{#if this.logo}}{{this.logo}}{{else}}/images/school-default.png{{/if}}"
                     alt="{{this.name}} logo"
                     class="rounded"
                     style="width:40px;height:40px;object-fit:cover;">
              </td>
              <td>{{this.name}}</td>
              <td>{{this.subdomain}}</td>
              <td>
                <span class="badge bg-success">{{this.status}}</span>
              </td>
              <td>
                <a href="/super-admin/schools/edit/{{this._id}}"
                   class="btn btn-sm btn-primary">
                  Edit
                </a>

                <form action="/super-admin/schools/delete/{{this._id}}"
                      method="POST"
                      class="d-inline"
                      onsubmit="return confirm('Delete this school?');">
                  <button class="btn btn-sm btn-danger" type="submit">
                    Delete
                  </button>
                </form>
              </td>
            </tr>
            {{/each}}
          </tbody>
        </table>
      </div>
      {{else}}
        <div class="alert alert-light">No active schools found.</div>
      {{/if}}

    </div>

    <!-- ================= INACTIVE SCHOOLS ================= -->
    <div class="tab-pane fade" id="inactiveTab" role="tabpanel">

      {{#if inactiveSchools.length}}
      <div class="table-responsive">
        <table id="inactiveTable" class="table table-striped table-bordered align-middle w-100">
          <thead class="table-light">
            <tr>
              <th>Logo</th>
              <th>School Name</th>
              <th>Subdomain</th>
              <th>Status</th>
              <th style="width:200px;">Actions</th>
            </tr>
          </thead>
          <tbody>
            {{#each inactiveSchools}}
            <tr>
              <td>
                <img src="{{#if this.logo}}{{this.logo}}{{else}}/images/school-default.png{{/if}}"
                     alt="{{this.name}} logo"
                     class="rounded"
                     style="width:40px;height:40px;object-fit:cover;">
              </td>
              <td>{{this.name}}</td>
              <td>{{this.subdomain}}</td>
              <td>
                <span class="badge bg-danger">{{this.status}}</span>
              </td>
              <td>
                <form action="/super-admin/schools/activate/{{this._id}}"
                      method="POST"
                      class="d-inline"
                      onsubmit="return confirm('Activate this school?');">
                  <button class="btn btn-sm btn-success" type="submit">
                    Activate
                  </button>
                </form>

                <form action="/super-admin/schools/delete/{{this._id}}"
                      method="POST"
                      class="d-inline"
                      onsubmit="return confirm('Delete this school?');">
                  <button class="btn btn-sm btn-danger" type="submit">
                    Delete
                  </button>
                </form>
              </td>
            </tr>
            {{/each}}
          </tbody>
        </table>
      </div>
      {{else}}
        <div class="alert alert-light">No inactive schools found.</div>
      {{/if}}

    </div>
  </div>
</div>

{{#section "styles"}}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.8/css/dataTables.bootstrap5.min.css">
{{/section}}

{{#section "scripts"}}
<script src="https://cdn.datatables.net/1.13.8/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.8/js/dataTables.bootstrap5.min.js"></script>

<script>
  $(function () {
    const activeTable = $('#activeTable').DataTable({
      pageLength: 10,
      responsive: true
    });

    const inactiveTable = $('#inactiveTable').DataTable({
      pageLength: 10,
      responsive: true
    });

    // Fix DataTables width when switching Bootstrap tabs
    $('button[data-bs-toggle="tab"]').on('shown.bs.tab', function () {
      activeTable.columns.adjust();
      inactiveTable.columns.adjust();
    });
  });
</script>
{{/section}}
