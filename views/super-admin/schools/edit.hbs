<div class="container py-4">

  <!-- Header -->
  <div class="d-flex align-items-center mb-4">
    <h4 class="mb-0">Edit {{school.name}}</h4>
  </div>

  {{> flashMessages}}

  <form action="/super-admin/schools/edit/{{school._id}}"
        method="POST"
        enctype="multipart/form-data">

    <div class="row g-4">

      <!-- ================= LOGO ================= -->
      <div class="col-12 col-md-4">
        <div class="card h-100 shadow-sm">
          <div class="card-body text-center">
            <h6 class="mb-3">School Logo</h6>

            <div
              id="logoDropzone"
              class="border border-2 border-dashed rounded d-flex align-items-center justify-content-center position-relative"
              style="height:200px; cursor:pointer;"
            >
              <img
                id="logoPreview"
                src="{{#if school.logo}}{{school.logo}}{{else}}/images/school-default.png{{/if}}"
                alt="School Logo"
                class="img-fluid"
                style="max-height:100%; object-fit:contain;"
              >

              <div
                id="logoOverlay"
                class="position-absolute top-0 start-0 w-100 h-100 d-flex flex-column align-items-center justify-content-center text-white"
                style="background:rgba(0,0,0,.55); opacity:0; transition:.2s;"
              >
                <i class="bi bi-cloud-upload fs-1"></i>
                <strong>Change Logo</strong>
                <small>Click or drag image</small>
              </div>
            </div>

            <input
              type="file"
              id="logoInput"
              name="logo"
              class="d-none"
              accept="image/*"
            >

            <small class="text-muted d-block mt-2">
              PNG/JPG, max 2MB. Leave empty to keep current logo.
            </small>
          </div>
        </div>
      </div>

      <!-- ================= DETAILS ================= -->
      <div class="col-12 col-md-8">
        <div class="card shadow-sm">
          <div class="card-body">

            <div class="mb-3">
              <label class="form-label">School Name</label>
              <input
                type="text"
                name="name"
                class="form-control"
                required
                value="{{#if old.name}}{{old.name}}{{else}}{{school.name}}{{/if}}"
              >
            </div>

            <div class="mb-3">
              <label class="form-label">Subdomain</label>
              <input
                type="text"
                name="subdomain"
                class="form-control"
                value="{{#if old.subdomain}}{{old.subdomain}}{{else}}{{school.subdomain}}{{/if}}"
              >
              <div class="form-text">Must be unique</div>
            </div>

            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">Email</label>
                <input
                  type="email"
                  name="email"
                  class="form-control"
                  value="{{#if old.email}}{{old.email}}{{else}}{{school.email}}{{/if}}"
                >
              </div>

              <div class="col-md-6">
                <label class="form-label">Phone</label>
                <input
                  type="text"
                  name="phone"
                  class="form-control"
                  value="{{#if old.phone}}{{old.phone}}{{else}}{{school.phone}}{{/if}}"
                >
              </div>
            </div>

            <div class="mt-3">
              <label class="form-label">Address</label>
              <input
                type="text"
                name="address"
                class="form-control"
                value="{{#if old.address}}{{old.address}}{{else}}{{school.address}}{{/if}}"
              >
            </div>

            <div class="mt-3">
              <label class="form-label">Status</label>
              <select name="status" class="form-select">
                <option value="Active" {{#ifCond school.status "Active"}}selected{{/ifCond}}>Active</option>
                <option value="Inactive" {{#ifCond school.status "Inactive"}}selected{{/ifCond}}>Inactive</option>
                <option value="Suspended" {{#ifCond school.status "Suspended"}}selected{{/ifCond}}>Suspended</option>
              </select>
            </div>

            <!-- Actions -->
            <div class="row mt-4 g-3">
              <div class="col-6">
                <a href="/super-admin/schools"
                   class="btn btn-outline-secondary w-100">
                  Back
                </a>
              </div>
              <div class="col-6">
                <button type="submit"
                        class="btn btn-primary w-100">
                  Save Changes
                </button>
              </div>
            </div>

          </div>
        </div>
      </div>

    </div>
  </form>
</div>

{{#section "scripts"}}

<script>
  (() => {
    const dz = document.getElementById("logoDropzone");
    const input = document.getElementById("logoInput");
    const preview = document.getElementById("logoPreview");
    const overlay = document.getElementById("logoOverlay");

    dz.addEventListener("click", () => input.click());
    dz.addEventListener("mouseenter", () => overlay.style.opacity = "1");
    dz.addEventListener("mouseleave", () => overlay.style.opacity = "0");

    input.addEventListener("change", () => {
      const file = input.files[0];
      if (file) preview.src = URL.createObjectURL(file);
    });

    dz.addEventListener("dragover", e => {
      e.preventDefault();
      overlay.style.opacity = "1";
    });

    dz.addEventListener("drop", e => {
      e.preventDefault();
      overlay.style.opacity = "0";

      if (!e.dataTransfer.files.length) return;
      input.files = e.dataTransfer.files;
      preview.src = URL.createObjectURL(e.dataTransfer.files[0]);
    });
  })();
</script>
{{/section}}
