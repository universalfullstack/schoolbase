<div class="container">

  <!-- Header -->
  <div class="row valign-wrapper mb-4">
    <div class="col s12 m6">
      <h4>Edit {{school.name}}</h4>
    </div>
  </div>

  {{> flashMessages}}

  <form action="/super-admin/schools/edit/{{school._id}}" method="POST" enctype="multipart/form-data">
    <div class="row">

      <!-- Logo -->
      <div class="col s12 m4">
        <div class="card center-align">
          <div class="card-content">
            <span class="card-title">School Logo</span>

            <div id="logoDropzone" class="z-depth-1 grey lighten-4" 
                 style="height:180px; cursor:pointer; position:relative; display:flex; align-items:center; justify-content:center;">
              
              <img id="logoPreview"
                   src="{{#if school.logo}}{{school.logo}}{{else}}/images/school-default.png{{/if}}" 
                   style="max-width:100%; max-height:100%; object-fit:contain;">

              <div id="logoOverlay" 
                   style="position:absolute; top:0; left:0; width:100%; height:100%; 
                          display:flex; flex-direction:column; align-items:center; justify-content:center;
                          background: rgba(0,0,0,0.55); color:white; opacity:0; transition:0.2s;">
                <i class="material-icons large">cloud_upload</i>
                <strong>Drop a new logo here</strong>
                <small>or click to browse</small>
              </div>
            </div>

            <input type="file" id="logoInput" name="logo" class="d-none" accept="image/*">

            <p class="grey-text text-darken-1" style="margin-top:10px; font-size:0.85rem;">
              Recommended: square image (PNG or JPG), max 2MB. Leave empty to keep current logo.
            </p>
          </div>
        </div>
      </div>

      <!-- Form Fields -->
      <div class="col s12 m8">
        <div class="card">
          <div class="card-content">

            <div class="input-field">
              <input id="name" type="text" name="name" value="{{old.name}}{{#unless old.name}}{{school.name}}{{/unless}}" required>
              <label for="name" class="active">School Name</label>
            </div>

            <div class="input-field">
              <input id="subdomain" type="text" name="subdomain" value="{{old.subdomain}}{{#unless old.subdomain}}{{school.subdomain}}{{/unless}}">
              <label for="subdomain" class="active">Subdomain</label>
              <span class="helper-text">Must be unique.</span>
            </div>

            <div class="input-field">
              <input id="email" type="email" name="email" value="{{old.email}}{{#unless old.email}}{{school.email}}{{/unless}}">
              <label for="email" class="active">Email</label>
            </div>

            <div class="input-field">
              <input id="phone" type="text" name="phone" value="{{old.phone}}{{#unless old.phone}}{{school.phone}}{{/unless}}">
              <label for="phone" class="active">Phone</label>
            </div>

            <div class="input-field">
              <input id="address" type="text" name="address" value="{{old.address}}{{#unless old.address}}{{school.address}}{{/unless}}">
              <label for="address" class="active">Address</label>
            </div>

            <div class="input-field">
              <select name="status" id="status">
                <option value="Active" {{#ifCond school.status "Active"}}selected{{/ifCond}}>Active</option>
                <option value="Inactive" {{#ifCond school.status "Inactive"}}selected{{/ifCond}}>Inactive</option>
                <option value="Suspended" {{#ifCond school.status "Suspended"}}selected{{/ifCond}}>Suspended</option>
              </select>
              <label>Status</label>
            </div>

            <div class="row" style="margin-top:20px;">
              <div class="col s6">
                <a href="/super-admin/schools" class="btn grey lighten-1 waves-effect waves-light w-100">Back</a>
              </div>
              <div class="col s6">
                <button type="submit" class="btn blue waves-effect waves-light w-100">Save Changes</button>
              </div>
            </div>

          </div>
        </div>
      </div>

    </div>
  </form>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Initialize Materialize select
    const selects = document.querySelectorAll('select');
    M.FormSelect.init(selects);

    // Logo Dropzone
    const dz = document.getElementById("logoDropzone");
    const input = document.getElementById("logoInput");
    const preview = document.getElementById("logoPreview");
    const overlay = document.getElementById("logoOverlay");

    dz.addEventListener("click", () => input.click());
    dz.addEventListener("mouseenter", () => overlay.style.opacity = "1");
    dz.addEventListener("mouseleave", () => overlay.style.opacity = "0");

    input.addEventListener("change", e => {
      const file = e.target.files[0];
      if (file) preview.src = URL.createObjectURL(file);
    });

    dz.addEventListener("dragover", e => {
      e.preventDefault();
      overlay.style.opacity = "1";
    });

    dz.addEventListener("dragleave", () => {
      overlay.style.opacity = "0";
    });

    dz.addEventListener("drop", e => {
      e.preventDefault();
      overlay.style.opacity = "0";
      const file = e.dataTransfer.files[0];
      if (!file) return;
      input.files = e.dataTransfer.files;
      preview.src = URL.createObjectURL(file);
    });
  });
</script>
