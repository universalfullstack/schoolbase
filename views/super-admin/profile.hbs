<div class="row justify-content-center">
  <div class="col-12 col-xl-10">

    <h1 class="h3 mb-4 text-center text-md-start">My Profile</h1>

    <!-- Alerts -->
    {{#if success}}
      <div class="alert alert-success alert-dismissible fade show" role="alert">
        {{success}}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>
    {{/if}}

    {{#if error}}
      <div class="alert alert-danger alert-dismissible fade show" role="alert">
        {{error}}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>
    {{/if}}

    <form
      action="/super-admin/profile"
      method="POST"
      enctype="multipart/form-data"
      class="row g-4"
    >

      <!-- ================= PROFILE IMAGE ================= -->
      <div class="col-lg-4">
        <div class="card shadow-sm h-100 text-center p-3">
          <h5 class="card-title mb-3">Profile Picture</h5>

          <div
            id="profile-dropzone"
            class="mx-auto rounded-circle border position-relative d-flex align-items-center justify-content-center"
            style="width:180px;height:180px;overflow:hidden;cursor:pointer;"
          >
            <img
              id="profilePreview"
              src="{{#if user.profileImage}}{{user.profileImage}}{{else}}/images/user-default.png{{/if}}"
              class="w-100 h-100"
              style="object-fit:cover;"
            >
            <div
              class="overlay position-absolute top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center bg-dark bg-opacity-25 text-white"
              style="opacity:0; transition:opacity .2s;"
            >
              <i class="bi bi-camera fs-1"></i>
            </div>
          </div>

          <input type="hidden" name="role" value="Super Admin">

          <input
            type="file"
            id="profileImageInput"
            name="profileImage"
            class="d-none"
            accept="image/*"
          >

          <p class="text-muted small mt-2 mb-0">
            Click or drag image to upload
          </p>
        </div>
      </div>

      <!-- ================= PROFILE FORM ================= -->
      <div class="col-lg-8">
        <div class="card shadow-sm h-100">
          <div class="card-body p-4">

            <div class="row g-3">

              <div class="col-md-6">
                <label class="form-label">First Name</label>
                <input type="text" name="firstName" class="form-control" value="{{#if user.firstName}}{{user.firstName}}{{/if}}" required>
              </div>

              <div class="col-md-6">
                <label class="form-label">Middle Name</label>
                <input type="text" name="middleName" class="form-control" value="{{#if user.middleName}}{{user.middleName}}{{/if}}">
              </div>

              <div class="col-md-6">
                <label class="form-label">Last Name</label>
                <input type="text" name="lastName" class="form-control" value="{{#if user.lastName}}{{user.lastName}}{{/if}}" required>
              </div>

              <div class="col-md-6">
                <label class="form-label">Gender</label>
                <select name="gender" class="form-select" required>
                  <option value="">Select gender</option>
                  <option value="Male" {{#ifCond user.gender "Male"}}selected{{/ifCond}}>Male</option>
                  <option value="Female" {{#ifCond user.gender "Female"}}selected{{/ifCond}}>Female</option>
                </select>
              </div>

              <!-- âœ… DATE PICKER FIX -->
              <div class="col-md-6">
                <label class="form-label">Date of Birth</label>
                <input
                  type="text"
                  id="dobPicker"
                  name="dateOfBirth"
                  class="form-control"
                  value="{{#if user.dateOfBirth}}{{user.dateOfBirth}}{{/if}}"
                  data-default-date="{{#if user.dateOfBirth}}{{user.dateOfBirth}}{{/if}}"
                  placeholder="Select date"
                >
              </div>

              <div class="col-md-6">
                <label class="form-label">Phone</label>
                <input type="text" name="phone" class="form-control" value="{{#if user.phone}}{{user.phone}}{{/if}}" required>
              </div>

              <div class="col-md-6">
                <label class="form-label">Email</label>
                <input type="email" name="email" class="form-control" value="{{#if user.email}}{{user.email}}{{/if}}" required>
              </div>

              <div class="col-md-6">
                <label class="form-label">Address</label>
                <input type="text" name="address" class="form-control" value="{{#if user.address}}{{user.address}}{{/if}}">
              </div>

            </div>

            <button type="submit" class="btn btn-primary mt-4 w-100">
              Update Profile
            </button>

          </div>
        </div>
      </div>

    </form>

  </div>
</div>

{{#section "styles"}}
<!-- ================= FLATPICKR CSS ================= -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
{{/section}}

{{#section "scripts"}}
<!-- ================= SCRIPTS ================= -->
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script>
  /* ================= DATE PICKER ================= */
  flatpickr("#dobPicker", {
    dateFormat: "Y-m-d",
    altInput: true,
    altFormat: "F j, Y",
    maxDate: "today",
    defaultDate: document.getElementById("dobPicker").dataset.defaultDate || null
  });

  /* ================= IMAGE UPLOAD ================= */
  const dropzone = document.getElementById('profile-dropzone');
  const fileInput = document.getElementById('profileImageInput');
  const preview = document.getElementById('profilePreview');
  const overlay = dropzone.querySelector('.overlay');

  dropzone.addEventListener('click', () => fileInput.click());
  dropzone.addEventListener('mouseenter', () => overlay.style.opacity = 1);
  dropzone.addEventListener('mouseleave', () => overlay.style.opacity = 0);

  fileInput.addEventListener('change', e => {
    const file = e.target.files[0];
    if (file && file.type.startsWith('image/')) {
      const reader = new FileReader();
      reader.onload = e => preview.src = e.target.result;
      reader.readAsDataURL(file);
    }
  });

  dropzone.addEventListener('dragover', e => {
    e.preventDefault();
    overlay.style.opacity = 1;
  });

  dropzone.addEventListener('dragleave', e => {
    e.preventDefault();
    overlay.style.opacity = 0;
  });

  dropzone.addEventListener('drop', e => {
    e.preventDefault();
    overlay.style.opacity = 0;

    const file = e.dataTransfer.files[0];
    if (file && file.type.startsWith('image/')) {
      fileInput.files = e.dataTransfer.files;
      const reader = new FileReader();
      reader.onload = e => preview.src = e.target.result;
      reader.readAsDataURL(file);
    }
  });
</script>
{{/section}}