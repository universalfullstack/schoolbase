<!-- ===================== register.hbs ===================== -->
<div class="mui-container-fluid" style="min-height: 100vh; display: flex; align-items: center; justify-content: center;">

  <div class="mui-col-md-5 mui-col-sm-10">

    <div class="mui-panel">

      <!-- Header -->
      <div class="mui--text-headline mui--text-dark-secondary" style="text-align: center;">
        <img src="{{#if settings.branding.logo}}{{settings.branding.logo}}{{else}}/images/school-default.png{{/if}}" 
             alt="School Logo" 
             style="max-height:80px; margin-bottom: 12px;" />

        <h5 class="mui--text-title">{{settings.general.systemName}} Portal</h5>
        <p class="mui--text-subhead mui--text-dark-secondary">
          Create an account to continue
        </p>
      </div>

      <!-- Flash Messages -->
      {{> flashMessages }}

      <!-- Registration Form -->
      <form action="/register" method="POST">

        <!-- Role -->
        <div class="mui-select" style="margin-top: 16px;">
          <select name="role" id="roleSelect" required>
            <option value="">Register As</option>
            <option value="School Admin">School Admin</option>
            <option value="Staff">Staff</option>
            <option value="Guardian">Guardian</option>
            <option value="Student">Student</option>
          </select>
          <label>Role</label>
        </div>

        <!-- Names -->
        <div class="mui-textfield mui-textfield--float-label">
          <input name="firstName" required />
          <label>First Name</label>
        </div>

        <div class="mui-textfield mui-textfield--float-label">
          <input name="middleName" />
          <label>Middle Name</label>
        </div>

        <div class="mui-textfield mui-textfield--float-label">
          <input name="lastName" required />
          <label>Last Name</label>
        </div>

        <!-- Gender -->
        <div class="mui-select">
          <select name="gender" required>
            <option value=""></option>
            <option>Male</option>
            <option>Female</option>
          </select>
          <label>Gender</label>
        </div>

        <!-- Phone -->
        <div class="mui-textfield mui-textfield--float-label">
          <input name="phone" required />
          <label>Phone Number</label>
        </div>

        <!-- Email -->
        <div class="mui-textfield mui-textfield--float-label">
          <input name="email" type="email" required />
          <label>Email Address</label>
        </div>

        <!-- Password -->
        <div class="mui-textfield mui-textfield--float-label" style="position: relative;">
          <input id="password" name="password" type="password" required />
          <label>Password</label>
          <span id="togglePassword" class="material-icons"
                style="position:absolute; right:8px; top:50%; transform:translateY(-50%); cursor:pointer;">
            visibility
          </span>
        </div>

        <!-- School (Staff / Guardian / Student) -->
        <div class="mui-select mui--hide" id="schoolField">
          <select name="school">
            <option value=""></option>
            {{#each schools}}
              <option value="{{_id}}">{{name}}</option>
            {{/each}}
          </select>
          <label>School</label>
        </div>

        <!-- Schools (School Admin) -->
        <div class="mui-select mui--hide" id="schoolsField">
          <select name="schools">
            <option value=""></option>
            {{#each schools}}
              <option value="{{_id}}">{{name}}</option>
            {{/each}}
          </select>
          <label>Assign School</label>
        </div>

        <!-- Submit -->
        <div class="mui--text-center" style="margin-top: 20px;">
          <button type="submit"
                  class="mui-btn mui-btn--raised mui-btn--primary mui--text-uppercase"
                  style="width:100%;">
            Register
          </button>
        </div>

      </form>

      <!-- Login Link -->
      <div class="mui--text-center" style="margin-top: 14px;">
        Already have an account?
        <a href="/login">Login</a>
      </div>

    </div>

  </div>
</div>

{{#section "scripts"}}
<script>
  document.addEventListener('DOMContentLoaded', function () {

    const roleSelect   = document.getElementById('roleSelect');
    const schoolField  = document.getElementById('schoolField');
    const schoolsField = document.getElementById('schoolsField');
    const toggle       = document.getElementById('togglePassword');
    const password     = document.getElementById('password');

    roleSelect.addEventListener('change', function () {
      schoolField.classList.add('mui--hide');
      schoolsField.classList.add('mui--hide');

      if (['Staff', 'Guardian', 'Student'].includes(this.value)) {
        schoolField.classList.remove('mui--hide');
      }

      if (this.value === 'School Admin') {
        schoolsField.classList.remove('mui--hide');
      }
    });

    toggle.addEventListener('click', function () {
      const type = password.type === 'password' ? 'text' : 'password';
      password.type = type;
      toggle.textContent = type === 'password' ? 'visibility' : 'visibility_off';
    });

  });
</script>
{{/section}}
